var __assign=function(){return(__assign=Object.assign||function(n){for(var e,t=1,a=arguments.length;t<a;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)};function __spreadArrays(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var a=Array(n),r=0,e=0;e<t;e++)for(var i=arguments[e],o=0,l=i.length;o<l;o++,r++)a[r]=i[o];return a}var copyPoint=function(n){return{x:n.x,y:n.y,handleIn:__assign({},n.handleIn),handleOut:__assign({},n.handleOut)}},forPoints=function(t,a){function n(n){function e(n){return copyPoint(t[mod(n,t.length)])}a({curr:copyPoint(t[n]),index:n,sibling:e,prev:function(){return e(n-1)},next:function(){return e(n+1)}})}for(var e=0;e<t.length;e++)n(e)},mapPoints=function(n,e){var t=[];return forPoints(n,function(n){t.push(e(n))}),t},coordEqual=function(n,e){return n.x===e.x&&n.y===e.y},angleOf=function(n,e){var t=e.x-n.x,n=-e.y+n.y,t=Math.atan2(n,t);return t<0?Math.abs(t):2*Math.PI-t},expandHandle=function(n,e){return{x:n.x+e.length*Math.cos(e.angle),y:n.y+e.length*Math.sin(e.angle)}},collapseHandle=function(n,e){return{angle:angleOf(n,e),length:Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}},length=function(n,e){var t=expandHandle(n,n.handleOut),a=expandHandle(e,e.handleIn);return(distance(n,e)+distance(t,a)+n.handleOut.length+e.handleIn.length)/2},reverse=function(t){return mapPoints(t,function(n){var e=n.index,e=(0,n.sibling)(t.length-e-1);return e.handleIn.angle+=Math.PI,e.handleOut.angle+=Math.PI,e})},shift=function(t,n){return mapPoints(n,function(n){var e=n.index;return(0,n.sibling)(e+t)})},insertAt=function(n,e,t){var a=copyPoint(e);a.handleOut.length*=n;var r=copyPoint(t);r.handleIn.length*=1-n;var i=expandHandle(e,e.handleOut),o=expandHandle(t,t.handleIn),e=expandHandle(a,a.handleOut),t=expandHandle(r,r.handleIn),o=splitLine(n,i,o),e=splitLine(n,e,o),o=splitLine(1-n,t,o),n=splitLine(n,e,o);return[a,{x:n.x,y:n.y,handleIn:collapseHandle(n,e),handleOut:collapseHandle(n,o)},r]},insertCount=function(n,e,t){if(n<2)return[e,t];var a=insertAt(1/n,e,t),e=a[0],t=a[1],a=a[2];return 2===n?[e,t,a]:__spreadArrays([e],insertCount(n-1,t,a))},smooth=function(n,r){return mapPoints(n,function(n){var e=n.curr,t=n.next,a=n.prev,n=angleOf(a(),t());return{x:e.x,y:e.y,handleIn:{angle:n+Math.PI,length:r*distance(e,a())},handleOut:{angle:n,length:r*distance(e,t())}}})},mod=function(n,e){return(n%e+e)%e},distance=function(n,e){return Math.sqrt(Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2))},split=function(n,e,t){return e+n*(t-e)},splitLine=function(n,e,t){return{x:split(n,e.x,t.x),y:split(n,e.y,t.y)}},renderPath2D=function(n){var a=new Path2D;return n.length<1||(a.moveTo(n[0].x,n[0].y),forPoints(n,function(n){var e=n.curr,t=(0,n.next)(),n=expandHandle(e,e.handleOut),e=expandHandle(t,t.handleIn);a.bezierCurveTo(n.x,n.y,e.x,e.y,t.x,t.y)})),a},rand=function(n){var e,t,a,r,n=function(n){for(var e=2166136261,t=0;t<n.length;t++)e=Math.imul(e^n.charCodeAt(t),16777619);return function(){return e+=e<<13,e^=e>>>7,e+=e<<3,e^=e>>>17,(e+=e<<5)>>>0}}(n);return e=n(),t=n(),a=n(),r=n(),function(){var n=(e>>>=0)+(t>>>=0)|0;return e=t^t>>>9,t=(a>>>=0)+(a<<3)|0,a=(a=a<<21|a>>>11)+(n=n+(r=(r>>>=0)+1|0)|0)|0,(n>>>0)/4294967296}},genBlob=function(n,e){for(var t=2*Math.PI/n,a=[],r=0;r<n;r++){var i=e(),o=Math.sin(r*t),l=Math.cos(r*t);a.push({x:.5+o*i,y:.5+l*i,handleIn:{angle:0,length:0},handleOut:{angle:0,length:0}})}var s=4/3*Math.tan(t/4)/Math.sin(t/2)/2;return smooth(a,s)},genFromOptions=function(n){var e=rand(String(n.seed)),t=1/(1+n.randomness/10),a=genBlob(3+n.extraPoints,function(){return(t+e()*(1-t))/2}),r=n.size;return mapPoints(a,function(n){n=n.curr;return n.x*=r,n.y*=r,n.handleIn.length*=r,n.handleOut.length*=r,n})},linear=function(n){return n},easeEnd=function(n){return 1-Math.pow(n-1,2)},easeStart=function(n){return 1-easeEnd(1-n)},ease=function(n){return.5+.5*Math.sin(Math.PI*(n+1.5))},elasticEnd=function(e){return function(n){return Math.pow(2,-10*n)*Math.sin((n-e/4)*(2*Math.PI)/e)+1}},timingFunctions={linear:linear,easeEnd:easeEnd,easeStart:easeStart,ease:ease,elasticEnd0:elasticEnd(1),elasticEnd1:elasticEnd(.64),elasticEnd2:elasticEnd(.32),elasticEnd3:elasticEnd(.16)},optimizeOrder=function(r,n){function e(n){for(var e=0;e<i;e++){for(var t=0,a=0;a<i&&(t+=Math.pow(100*distance(r[a],n[mod(a+e,i)]),2),!(o<t));a++);t<=o&&(o=t,l=e,s=n)}}var i=r.length,o=1/0,l=0,s=[];return e(n),e(reverse(n)),shift(l,s)},divide=function(n,e){if(e.length<3)throw new Error("not enough points");if(n<e.length)throw new Error("cannot remove points");if(n===e.length)return e.slice();var t=[];forPoints(e,function(n){var e=n.curr,n=n.next;t.push(length(e,n()))});for(var a=divideLengths(t,n-e.length),r=[],i=0;i<e.length;i++){var o=r[r.length-1]||e[i],l=e[mod(i+1,e.length)];r.pop(),r.push.apply(r,insertCount(a[i],o,l))}n=r.pop();return r[0].handleIn=n.handleIn,r},fixAnglesWith=function(n,r){return mapPoints(n,function(n){var e=n.index,t=n.curr,a=n.prev,n=n.next;return 0===t.handleIn.length&&coordEqual(a(),t)&&(t.handleIn.angle=r[e].handleIn.angle),0===t.handleOut.length&&coordEqual(n(),t)&&(t.handleOut.angle=r[e].handleOut.angle),t})},fixAnglesSelf=function(n){return mapPoints(n,function(n){var e=n.curr,t=n.prev,n=n.next,n=angleOf(t(),n());return 0===e.handleIn.length&&(e.handleIn.angle=n+Math.PI),0===e.handleOut.length&&(e.handleOut.angle=n),e})},divideLengths=function(n,e){for(var t=n.map(function(){return 1}),a=n.slice(),r=0;r<e;r++){for(var i=0,o=1;o<a.length;o++)(a[o]>a[i]||a[o]===a[i]&&n[o]>n[i])&&(i=o);t[i]++,a[i]=n[i]/t[i]}return t},prepare=function(n,e,t){var a=t.divideRatio*Math.max(n.length,e.length),n=divide(a,n),e=divide(a,e),e=optimizeOrder(n,e);return[t.rawAngles?n:fixAnglesWith(fixAnglesSelf(n),e),t.rawAngles?e:fixAnglesWith(fixAnglesSelf(e),n)]},interpolateAngle=function(n,e,t){var a=2*Math.PI,e=mod(e,a),t=mod(t,a);return Math.abs(e-t)>Math.PI&&(e<t?e+=a:t+=a),split(n,e,t)},interpolateBetween=function(n,e,t){if(e.length!==t.length)throw new Error("must have equal number of points");for(var a=Math.min(1,Math.max(0,n)),r=[],i=0;i<e.length;i++)r.push(__assign(__assign({},splitLine(n,e[i],t[i])),{handleIn:{angle:interpolateAngle(n,e[i].handleIn.angle,t[i].handleIn.angle),length:split(a,e[i].handleIn.length,t[i].handleIn.length)},handleOut:{angle:interpolateAngle(n,e[i].handleOut.angle,t[i].handleOut.angle),length:split(a,e[i].handleOut.length,t[i].handleOut.length)}}));return r},genId=function(){return String(Math.random()).substr(2)},renderFramesAt=function(n){var e=n.renderCache,t=n.currentFrames;if(0===t.length)return{renderCache:e,lastFrameId:null,points:[]};if(1===t.length){var a=t[0];return{renderCache:e,lastFrameId:a.id,points:a.initialPoints}}for(var r=t[0],i=t[1],o=2;o<t.length&&!(i.timestamp>n.timestamp);o++)r=t[o-1],i=t[o];var l=i===t[t.length-1];if(i.timestamp<n.timestamp&&l)return{renderCache:e,lastFrameId:i.id,points:i.initialPoints};var a=null===(s=e[r.id])||void 0===s?void 0:s.preparedStartPoints,s=null===(l=e[i.id])||void 0===l?void 0:l.preparedEndPoints;a&&s||(a=(u=prepare(r.initialPoints,i.initialPoints,{rawAngles:!1,divideRatio:1}))[0],s=u[1],e[r.id]=e[r.id]||{},e[r.id].preparedStartPoints=a,e[i.id]=e[i.id]||{},e[i.id].preparedEndPoints=s);var l=(n.timestamp-r.timestamp)/(i.timestamp-r.timestamp),u=Math.max(0,Math.min(1,l)),l=i.timingFunction(u);return{renderCache:e,lastFrameId:(1===u?i:r).id,points:interpolateBetween(l,a,s)}},transitionFrames=function(n){var e=[];if(0===n.newFrames.length)return{newFrames:e};var t=renderFramesAt(n);if(null===t.lastFrameId){for(var a=n.shapeGenerator(n.newFrames[0]),r={x:0,y:0,handleIn:{angle:0,length:0},handleOut:{angle:0,length:0}},i=0,o=a;i<o.length;i++){var l=o[i];r.x+=l.x/a.length,r.y+=l.y/a.length}t.points=[r,r,r]}e.push({id:genId(),initialPoints:t.points,timestamp:n.timestamp,timingFunction:timingFunctions.linear,transitionSourceFrameIndex:-1,isSynthetic:!0});for(var s=0,u=0;u<n.newFrames.length;u++){var h,d=n.newFrames[u];d.delay&&(s+=d.delay,h=e[e.length-1],e.push({id:genId(),initialPoints:h.initialPoints,timestamp:n.timestamp+s,timingFunction:timingFunctions.linear,transitionSourceFrameIndex:u-1,isSynthetic:!0})),s+=d.duration,e.push({id:genId(),initialPoints:n.shapeGenerator(d),timestamp:n.timestamp+s,timingFunction:timingFunctions[d.timingFunction||"linear"],transitionSourceFrameIndex:u,isSynthetic:!1})}return{newFrames:e}},statefulAnimationGenerator=function(c,i,p){return function(){function s(){return Date.now()-r}function e(){return 0!==a}function n(){e()&&(r+=s()-a,a=0)}function t(){e()||(a=s())}var u=[],h={},d={},a=0,r=0;return{renderFrame:function(){var n=renderFramesAt({renderCache:h,timestamp:e()?a:s(),currentFrames:u});return h=n.renderCache,n.lastFrameId&&d[n.lastFrameId]&&(d[n.lastFrameId](),delete d[n.lastFrameId]),i(n.points)},transition:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=0;t<n.length;t++)p(n[t],t);var a=transitionFrames({renderCache:h,timestamp:s(),currentFrames:u,newFrames:n,shapeGenerator:c});u=a.newFrames,d={},h={};for(var r=0,i=u;r<i.length;r++){var o,l=i[r];l.isSynthetic||(o=n[l.transitionSourceFrameIndex].callback)&&(d[l.id]=o)}},play:n,pause:t,playPause:function(){(e()?n:t)()}}}},typeCheck=function(n,e,t){var a=typeof e;if("number"===a&&isNaN(e)&&(a="NaN"),!t.includes(a="object"===a&&null===e?"null":a))throw'"'+n+'" should have type "'+t.join("|")+'" but was "'+a+'".'},checkKeyframeOptions=function(n){typeCheck("keyframe",n,["object"]);var e=n.delay,t=n.duration,a=n.timingFunction,n=n.callback;if(typeCheck("delay",e,["number","undefined"]),e&&e<0)throw'delay is invalid "'+e+'".';if(typeCheck("duration",t,["number"]),t&&t<0)throw'duration is invalid "'+t+'".';if(typeCheck("timingFunction",a,["string","undefined"]),a&&!timingFunctions[a])throw'".timingFunction" is not recognized "'+a+'".';typeCheck("callback",n,["function","undefined"])},checkBlobOptions=function(n){typeCheck("blobOptions",n,["object"]);var e=n.seed,t=n.extraPoints,a=n.randomness,n=n.size;if(typeCheck("blobOptions.seed",e,["string","number"]),typeCheck("blobOptions.extraPoints",t,["number"]),t<0)throw'blobOptions.extraPoints is invalid "'+t+'".';if(typeCheck("blobOptions.randomness",a,["number"]),a<0)throw'blobOptions.randomness is invalid "'+a+'".';if(typeCheck("blobOptions.size",n,["number"]),n<0)throw'blobOptions.size is invalid "'+n+'".'},checkCanvasOptions=function(n){var e;typeCheck("canvasOptions",n,["object","undefined"]),n&&(e=n.offsetX,n=n.offsetY,typeCheck("canvasOptions.offsetX",e,["number","undefined"]),typeCheck("canvasOptions.offsetY",n,["number","undefined"]))},canvasBlobGenerator=function(t){return mapPoints(genFromOptions(t.blobOptions),function(n){var e=n.curr;return e.x+=(null===(n=null==t?void 0:t.canvasOptions)||void 0===n?void 0:n.offsetX)||0,e.y+=(null===(n=null==t?void 0:t.canvasOptions)||void 0===n?void 0:n.offsetY)||0,e})},canvasKeyframeChecker=function(n,e){try{checkBlobOptions(n.blobOptions),checkCanvasOptions(n.canvasOptions),checkKeyframeOptions(n)}catch(n){throw"(blobs2): keyframe "+e+": "+n}},canvasPath=statefulAnimationGenerator(canvasBlobGenerator,renderPath2D,canvasKeyframeChecker);export{canvasPath};
//# sourceMappingURL=index.module.js.map
